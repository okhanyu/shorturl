<!DOCTYPE html>
<html lang="zh-ch" >
<head>
   <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no,maximum-scale=1,viewport-fit=cover,shrink-to-fit=no">
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <link rel="shortcut icon" type="image/x-icon" href="favicon.ico">
    <title>SHORT URL TOOL !</title>
    <link rel="stylesheet" href="./style.css">
    <style>
       
    </style>
</head>
<body>
<div class="contain" style="">
	<form id="short-url-form">
		<h4>
			Going.ee | SHORT URL TOOL!
		</h4>
		<input type="text" id="username" placeholder="Username">
		<input type="password" id="password" placeholder="Password">
		<input type="text" id="url" placeholder="URL to shorten">
		<div class="wrapper">
			<button type="submit" id="sub">
				<a>
					<div class="scale rotate-4">
						G
					</div>
					<div class="scale rotate-2">
						e
					</div>
					<div class="scale rotate-3">
					
					</div>
					<div class="scale rotate-1">
						t
					</div>
					<div class="scale rotate-2">
					</div>
				</a>
			</button>
		</div>
	</form>
	<div id="resultParent">
		<div id="tips"></div>
		<div id="result">
		</div>
		<div class="wrapper">
			<button id="copyButton">
				<a>
					<div class="scale rotate-4">
						C
					</div>
					<div class="scale rotate-2">
						o
					</div>
					<div class="scale rotate-3">
						p
					</div>
					<div class="scale rotate-1">
						y
					</div>
					<div class="scale rotate-2">
					</div>
				</a>
			</button>
		</div>
	</div>
</div>
<br>
   <script>

        var domain = "https://go.going.ee/";
        var apiurl = "https://go.going.ee";
        document.getElementById('short-url-form').addEventListener('submit', async function(e) {
            e.preventDefault();

            document.getElementById('result').innerText = "";

            let username = document.getElementById('username').value;
            let password = document.getElementById('password').value;
            let url = document.getElementById('url').value;

            if (username == "" || username == "" || url == ""){
               document.getElementById('tips').innerText = "No, Incomplete Form"; 
               return;
            }

           document.getElementById('tips').innerText = "Processing...";

            

            let response = await fetch(apiurl, {
                method: 'POST',
                headers: {
                    'Authorization': 'Basic ' + username + ':' + password,
                    'Content-Type': 'text/plain'
                },
                body: url
            });

            if (response.ok) {
                let id = await response.text();
                var r = domain + id;
                document.getElementById('result').innerHTML = '<a id="resultLink" target="_blank" href="' + r +'"/>'+r+'</a>';
                document.getElementById('tips').innerText = "Success : ";

            } else {
                var err = response.status == 401 ? '账密错误':'';
                document.getElementById('result').textContent = response.status + ' Error : ' + err;
            }
        });

        document.getElementById('copyButton').addEventListener('click', function() {
            var resultLink = document.getElementById('resultLink');
            if (resultLink) {
                navigator.clipboard.writeText(resultLink.href).then(function() {
                	   document.getElementById('tips').innerText = " URL copied to clipboard !";
                    // document.getElementById('copyButton').textContent = ' URL copied to clipboard!';
                }, function(err) {
                	 document.getElementById('tips').innerText = ' Error copying URL: ' + err;
                    // document.getElementById('copyButton').textContent = ' Error copying URL: ' + err;
                });
            }
        });
    </script>
</body>
</html>
